{"posts":[{"title":"Go日志库Zap与lumberjack配置","content":"packagecoreimport(&quot;go-gin-api-example/core/global&quot;&quot;go.uber.org/zap&quot;&quot;go.uber.org/zap/zapcore&quot;&quot;gopkg.in/natefinch/lumberjack.v2&quot;&quot;os&quot;)varlogConfig=global.CONFIG.LogfuncinitZapLogger(){varlogger*zap.Loggercore:=zapcore.NewCore(newZapEncoder(),newWriteSyncer(),newZapLevel())//setinitializefieldsfield:=zap.Fields(zap.String(&quot;ApplicationName&quot;,global.CONFIG.App.Name))//judgecurrentenvironmentispro?ifglobal.CONFIG.App.Env!=&quot;pro&quot;{//enabledevmodecaller:=zap.AddCaller()development:=zap.Development()logger=zap.New(core,caller,development,field)}else{logger=zap.New(core,field)}//saveasaglobalvariableglobal.LOG=logger}funcnewWriteSyncer()zapcore.WriteSyncer{iflogConfig.EnableLogFile{returnzapcore.NewMultiWriteSyncer(zapcore.AddSync(os.Stdout))}else{hook:=lumberjack.Logger{Filename:logConfig.File.Path,MaxSize:logConfig.File.MaxSize,MaxBackups:logConfig.File.MaxBackups,MaxAge:logConfig.File.MaxAge,Compress:logConfig.File.Compress,}returnzapcore.NewMultiWriteSyncer(zapcore.AddSync(os.Stdout),zapcore.AddSync(&amp;hook))}}funcnewZapEncoder()zapcore.Encoder{encoderCfg:=zapcore.EncoderConfig{TimeKey:&quot;time&quot;,LevelKey:&quot;level&quot;,NameKey:&quot;logger&quot;,CallerKey:&quot;linenum&quot;,MessageKey:&quot;msg&quot;,StacktraceKey:&quot;stacktrace&quot;,LineEnding:zapcore.DefaultLineEnding,EncodeLevel:zapcore.LowercaseLevelEncoder,//小写编码器EncodeTime:zapcore.ISO8601TimeEncoder,//ISO8601UTC时间格式EncodeDuration:zapcore.SecondsDurationEncoder,//EncodeCaller:zapcore.FullCallerEncoder,//全路径编码器EncodeName:zapcore.FullNameEncoder,}iflogConfig.Encoder==&quot;json&quot;{returnzapcore.NewJSONEncoder(encoderCfg)}else{returnzapcore.NewConsoleEncoder(encoderCfg)}}funcnewZapLevel()zap.AtomicLevel{levelMap:=map[string]zapcore.Level{&quot;DEBUG&quot;:zap.DebugLevel,&quot;INFO&quot;:zap.InfoLevel,&quot;WARN&quot;:zap.WarnLevel,&quot;ERROR&quot;:zap.ErrorLevel,&quot;DPANIC&quot;:zap.DPanicLevel,&quot;PANIC&quot;:zap.PanicLevel,&quot;FATAL&quot;:zap.FatalLevel,}level:=zap.NewAtomicLevel()ifl,ok:=levelMap[logConfig.Level];ok{level.SetLevel(l)}else{level.SetLevel(zap.InfoLevel)}returnlevel}","link":"https://blog.yguilai.com/L_yuiYNgS/"},{"title":"ElementUI自定义上传 -以上传图标到七牛云为例","content":"解决ElementUI上传组件无法获取内部文件列表的缺陷&lt;template&gt;&lt;div&gt;&lt;el-uploadaction=&quot;#&quot;class=&quot;icon-uploader&quot;:auto-upload=&quot;false&quot;:on-change=&quot;onIcoUploadChange&quot;:show-file-list=&quot;false&quot;accept=&quot;image/*&quot;&gt;&lt;imgv-if=&quot;imageUrl!==''&quot;:src=&quot;imageUrl&quot;class=&quot;ico&quot;/&gt;&lt;iv-elseclass=&quot;el-icon-plus&quot;/&gt;&lt;divslot=&quot;tip&quot;class=&quot;el-upload__tip&quot;&gt;只能上传图片文件，且不超过200kb&lt;/div&gt;&lt;/el-upload&gt;&lt;el-button@click=&quot;upload()&quot;&gt;上传&lt;/el-button&gt;&lt;/div&gt;&lt;/template&gt;&lt;script&gt;exportdefault{data(){return{icoFile:null,imageUrl:'',qiniuToken:''}},methods:{//获取上传的文件对象onIcoUploadChange(file,fileList){this.icoFile=file//创建一个本地blob链接用于图片预览this.imageUrl=URL.createObjectURL(file.raw)},//上传文件到七牛asyncupload(){if(this.icoFile===null){this.$message.error('请先上传文件')return}//判断token是否为空if(this.qiniuToken===''){try{const{data}=awaitgetQiniuToken()this.qiniuToken=data}catch(err){this.$message.error(err.message)return}}letfileKey=''try{constformData=newFormData()formData.append('file',this.icoFile)formData.append('token',this.qiniuToken)const{key}=awaituploadImg2Qiniu(formData)fileKey=key//发送请求将key存到数据库//...}catch(err){this.$message.error(err.message)}}}}&lt;/script&gt;&lt;stylelang=&quot;scss&quot;scope&gt;$icoSize:64px;.icon-uploader.el-upload{width:$icoSize;height:$icoSize;position:relative;overflow:hidden;border:1pxdashed#d9d9d9;border-radius:6px;cursor:pointer;position:relative;overflow:hidden;&amp;:hover{border-color:#409eff;}}.icon-uploader.ico{width:$icoSize;height:$icoSize;}.icon-uploader.el-upload.el-icon-plus{width:$icoSize;height:$icoSize;font-size:20px;color:#8c939d;line-height:$icoSize;text-align:center;}&lt;/style&gt;获取token及上传图片importrequestfrom'@/utils/request'//获取后端生成的tokenexportfunctiongetQiniuToken(){returnrequest({url:'/qntoken',method:'GET'})}exportfunctionuploadImg2Qiniu(formdata){returnrequest({//该api从七牛获取,不同地域的存储桶对应api不同url:process.env.VUE_APP_QINIU_UPLOAD_API,method:'POST',headers:{'Content-Type':'multipart/form-data'},withCredentials:false,//禁止跨域携带cookie，带cookie在七牛上有可能出现跨域问题timeout:30000,data:formdata})}","link":"https://blog.yguilai.com/elementui-zi-ding-yi-shang-chuan-yi-shang-chuan-tu-biao-dao-qi-niu-yun-wei-li/"}]}